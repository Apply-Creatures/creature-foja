<div class="issue-content-right ui segment">
	{{template "repo/issue/view_content/sidebar/branch_selector_field" .}}
	{{if .Issue.IsPull}}
		{{template "repo/issue/view_content/sidebar/pull_review" .}}
		{{template "repo/issue/view_content/sidebar/pull_wip" .}}
		<div class="divider"></div>
	{{end}}

	{{template "repo/issue/labels/labels_selector_field" .}}
	{{template "repo/issue/labels/labels_sidebar" dict "root" $}}

	<div class="divider"></div>

	{{template "repo/issue/view_content/sidebar/milestones" .}}
	<div class="divider"></div>

	{{template "repo/issue/view_content/sidebar/projects" .}}
	<div class="divider"></div>

	{{template "repo/issue/view_content/sidebar/assignees" .}}
	<div class="divider"></div>

	{{if .Participants}}
		{{template "repo/issue/view_content/sidebar/participants" .}}
	{{end}}

	{{if and $.IssueWatch (not .Repository.IsArchived)}}
		<div class="divider"></div>

		{{template "repo/issue/view_content/sidebar/watch" .}}
	{{end}}

	{{if .Repository.IsTimetrackerEnabled $.Context}}
		{{template "repo/issue/view_content/sidebar/timetracking" .}}
	{{end}}

	<div class="divider"></div>
	{{template "repo/issue/view_content/sidebar/due_deadline" .}}

	{{if .Repository.IsDependenciesEnabled $.Context}}
		<div class="divider"></div>

		<div class="ui depending">
			{{if (and (not .BlockedByDependencies) (not .BlockedByDependenciesNotPermitted) (not .BlockingDependencies) (not .BlockingDependenciesNotPermitted))}}
				<span class="text"><strong>{{ctx.Locale.Tr "repo.issues.dependency.title"}}</strong></span>
				<br>
				<p>
					{{if .Issue.IsPull}}
						{{ctx.Locale.Tr "repo.issues.dependency.pr_no_dependencies"}}
					{{else}}
						{{ctx.Locale.Tr "repo.issues.dependency.issue_no_dependencies"}}
					{{end}}
				</p>
			{{end}}

			{{if or .BlockingDependencies .BlockingDependenciesNotPermitted}}
				<span class="text" data-tooltip-content="{{if .Issue.IsPull}}{{ctx.Locale.Tr "repo.issues.dependency.pr_close_blocks"}}{{else}}{{ctx.Locale.Tr "repo.issues.dependency.issue_close_blocks"}}{{end}}">
					<strong>{{ctx.Locale.Tr "repo.issues.dependency.blocks_short"}}</strong>
				</span>
				<div class="ui relaxed divided list">
					{{range .BlockingDependencies}}
						<div class="item dependency{{if .Issue.IsClosed}} is-closed{{end}} tw-flex tw-items-center tw-justify-between">
							<div class="item-left tw-flex tw-justify-center tw-flex-col tw-flex-1 gt-ellipsis">
								<a class="title muted" href="{{.Issue.Link}}" data-tooltip-content="#{{.Issue.Index}} {{.Issue.Title | RenderEmoji $.Context}}">
									#{{.Issue.Index}} {{.Issue.Title | RenderEmoji $.Context}}
								</a>
								<div class="text small gt-ellipsis" data-tooltip-content="{{.Repository.OwnerName}}/{{.Repository.Name}}">
									{{.Repository.OwnerName}}/{{.Repository.Name}}
								</div>
							</div>
							<div class="item-right tw-flex tw-items-center tw-m-1">
								{{if and $.CanCreateIssueDependencies (not $.Repository.IsArchived)}}
									<a class="delete-dependency-button ci muted" data-id="{{.Issue.ID}}" data-type="blocking" data-tooltip-content="{{ctx.Locale.Tr "repo.issues.dependency.remove_info"}}">
										{{svg "octicon-trash" 16}}
									</a>
								{{end}}
							</div>
						</div>
					{{end}}
					{{if .BlockingDependenciesNotPermitted}}
						<div class="item tw-flex tw-items-center tw-justify-between gt-ellipsis">
							<span>{{ctx.Locale.TrN (len .BlockingDependenciesNotPermitted) "repo.issues.dependency.no_permission_1" "repo.issues.dependency.no_permission_n" (len .BlockingDependenciesNotPermitted)}}</span>
						</div>
					{{end}}
				</div>
			{{end}}

			{{if or .BlockedByDependencies .BlockedByDependenciesNotPermitted}}
				<span class="text" data-tooltip-content="{{if .Issue.IsPull}}{{ctx.Locale.Tr "repo.issues.dependency.pr_closing_blockedby"}}{{else}}{{ctx.Locale.Tr "repo.issues.dependency.issue_closing_blockedby"}}{{end}}">
					<strong>{{ctx.Locale.Tr "repo.issues.dependency.blocked_by_short"}}</strong>
				</span>
				<div class="ui relaxed divided list">
					{{range .BlockedByDependencies}}
						<div class="item dependency{{if .Issue.IsClosed}} is-closed{{end}} tw-flex tw-items-center tw-justify-between">
							<div class="item-left tw-flex tw-justify-center tw-flex-col tw-flex-1 gt-ellipsis">
								<a class="title muted" href="{{.Issue.Link}}" data-tooltip-content="#{{.Issue.Index}} {{.Issue.Title | RenderEmoji $.Context}}">
									#{{.Issue.Index}} {{.Issue.Title | RenderEmoji $.Context}}
								</a>
								<div class="text small gt-ellipsis" data-tooltip-content="{{.Repository.OwnerName}}/{{.Repository.Name}}">
									{{.Repository.OwnerName}}/{{.Repository.Name}}
								</div>
							</div>
							<div class="item-right tw-flex tw-items-center tw-m-1">
								{{if and $.CanCreateIssueDependencies (not $.Repository.IsArchived)}}
									<a class="delete-dependency-button ci muted" data-id="{{.Issue.ID}}" data-type="blockedBy" data-tooltip-content="{{ctx.Locale.Tr "repo.issues.dependency.remove_info"}}">
										{{svg "octicon-trash" 16}}
									</a>
								{{end}}
							</div>
						</div>
					{{end}}
					{{if $.CanCreateIssueDependencies}}
						{{range .BlockedByDependenciesNotPermitted}}
							<div class="item dependency{{if .Issue.IsClosed}} is-closed{{end}} tw-flex tw-items-center tw-justify-between">
								<div class="item-left tw-flex tw-justify-center tw-flex-col tw-flex-1 gt-ellipsis">
									<div class="gt-ellipsis">
										<span data-tooltip-content="{{ctx.Locale.Tr "repo.issues.dependency.no_permission.can_remove"}}">{{svg "octicon-lock" 16}}</span>
										<span class="title" data-tooltip-content="#{{.Issue.Index}} {{.Issue.Title | RenderEmoji $.Context}}">
											#{{.Issue.Index}} {{.Issue.Title | RenderEmoji $.Context}}
										</span>
									</div>
									<div class="text small gt-ellipsis" data-tooltip-content="{{.Repository.OwnerName}}/{{.Repository.Name}}">
										{{.Repository.OwnerName}}/{{.Repository.Name}}
									</div>
								</div>
								<div class="item-right tw-flex tw-items-center tw-m-1">
									{{if and $.CanCreateIssueDependencies (not $.Repository.IsArchived)}}
										<a class="delete-dependency-button ci muted" data-id="{{.Issue.ID}}" data-type="blocking" data-tooltip-content="{{ctx.Locale.Tr "repo.issues.dependency.remove_info"}}">
											{{svg "octicon-trash" 16}}
										</a>
									{{end}}
								</div>
							</div>
						{{end}}
					{{else if .BlockedByDependenciesNotPermitted}}
						<div class="item tw-flex tw-items-center tw-justify-between gt-ellipsis">
							<span>{{ctx.Locale.TrN (len .BlockedByDependenciesNotPermitted) "repo.issues.dependency.no_permission_1" "repo.issues.dependency.no_permission_n" (len .BlockedByDependenciesNotPermitted)}}</span>
						</div>
					{{end}}
				</div>
			{{end}}

			{{if and .CanCreateIssueDependencies (not .Repository.IsArchived)}}
				<div>
					<form method="post" action="{{.Issue.Link}}/dependency/add" id="addDependencyForm">
						{{$.CsrfTokenHtml}}
						<div class="ui fluid action input">
							<div class="ui search selection dropdown" id="new-dependency-drop-list" data-issue-id="{{.Issue.ID}}">
								<input name="newDependency" type="hidden">
								{{svg "octicon-triangle-down" 14 "dropdown icon"}}
								<input type="text" class="search">
								<div class="default text">{{ctx.Locale.Tr "repo.issues.dependency.add"}}</div>
							</div>
							<button class="ui icon button">
								{{svg "octicon-plus"}}
							</button>
						</div>
					</form>
				</div>
			{{end}}
		</div>

		{{if and .CanCreateIssueDependencies (not .Repository.IsArchived)}}
			<input type="hidden" id="crossRepoSearch" value="{{.AllowCrossRepositoryDependencies}}">

			<div class="ui g-modal-confirm modal remove-dependency">
				<div class="header">
					{{svg "octicon-trash"}}
					{{ctx.Locale.Tr "repo.issues.dependency.remove_header"}}
				</div>
				<div class="content">
					<form method="post" action="{{.Issue.Link}}/dependency/delete" id="removeDependencyForm">
						{{$.CsrfTokenHtml}}
						<input type="hidden" value="" name="removeDependencyID" id="removeDependencyID">
						<input type="hidden" value="" name="dependencyType" id="dependencyType">
					</form>
					<p>{{if .Issue.IsPull}}
						{{ctx.Locale.Tr "repo.issues.dependency.pr_remove_text"}}
					{{else}}
						{{ctx.Locale.Tr "repo.issues.dependency.issue_remove_text"}}
					{{end}}</p>
				</div>
				{{$ModalButtonCancelText := ctx.Locale.Tr "repo.issues.dependency.cancel"}}
				{{$ModalButtonOkText := ctx.Locale.Tr "repo.issues.dependency.remove"}}
				{{template "base/modal_actions_confirm" (dict "." . "ModalButtonCancelText" $ModalButtonCancelText "ModalButtonOkText" $ModalButtonOkText)}}
			</div>
		{{end}}
	{{end}}

	<div class="divider"></div>
	<div class="ui equal width compact grid">
		{{$issueReferenceLink := printf "%s#%d" .Issue.Repo.FullName .Issue.Index}}
		<div class="row tw-items-center" data-tooltip-content="{{$issueReferenceLink}}">
			<span class="text column truncate">{{ctx.Locale.Tr "repo.issues.reference_link" $issueReferenceLink}}</span>
			<button class="ui two wide button column tw-p-2" data-clipboard-text="{{$issueReferenceLink}}">{{svg "octicon-copy" 14}}</button>
		</div>
	</div>

	{{if and .IsRepoAdmin (not .Repository.IsArchived)}}
		<div class="divider"></div>

		{{if or .PinEnabled .Issue.IsPinned}}
			<form class="tw-mt-1 form-fetch-action single-button-form" method="post" {{if $.NewPinAllowed}}action="{{.Issue.Link}}/pin"{{else}}data-tooltip-content="{{ctx.Locale.Tr "repo.issues.max_pinned"}}"{{end}}>
				{{$.CsrfTokenHtml}}
				<button class="fluid ui button {{if not $.NewPinAllowed}}disabled{{end}}">
					{{if not .Issue.IsPinned}}
						{{svg "octicon-pin" 16 "tw-mr-2"}}
						{{ctx.Locale.Tr "pin"}}
					{{else}}
						{{svg "octicon-pin-slash" 16 "tw-mr-2"}}
						{{ctx.Locale.Tr "unpin"}}
					{{end}}
				</button>
			</form>
		{{end}}

		<button class="tw-mt-1 fluid ui show-modal button {{if .Issue.IsLocked}} negative {{end}}" data-modal="#lock">
			{{if .Issue.IsLocked}}
				{{svg "octicon-key"}}
				{{ctx.Locale.Tr "repo.issues.unlock"}}
			{{else}}
				{{svg "octicon-lock"}}
				{{ctx.Locale.Tr "repo.issues.lock"}}
			{{end}}
		</button>
		<div class="ui tiny modal" id="lock">
			<div class="header">
				{{if .Issue.IsLocked}}
					{{ctx.Locale.Tr "repo.issues.unlock.title"}}
				{{else}}
					{{ctx.Locale.Tr "repo.issues.lock.title"}}
				{{end}}
			</div>
			<div class="content">
				<div class="ui warning message">
					{{if .Issue.IsLocked}}
						{{ctx.Locale.Tr "repo.issues.unlock.notice_1"}}<br>
						{{ctx.Locale.Tr "repo.issues.unlock.notice_2"}}<br>
					{{else}}
						{{ctx.Locale.Tr "repo.issues.lock.notice_1"}}<br>
						{{ctx.Locale.Tr "repo.issues.lock.notice_2"}}<br>
						{{ctx.Locale.Tr "repo.issues.lock.notice_3"}}<br>
					{{end}}
				</div>

				<form class="ui form form-fetch-action" action="{{.Issue.Link}}{{if .Issue.IsLocked}}/unlock{{else}}/lock{{end}}"
					method="post">
					{{.CsrfTokenHtml}}

					{{if not .Issue.IsLocked}}
						<div class="field">
							<strong> {{ctx.Locale.Tr "repo.issues.lock.reason"}} </strong>
						</div>

						<div class="field">
							<div class="ui fluid dropdown selection">

								<select name="reason">
									<option value=""> </option>
									{{range .LockReasons}}
										<option value="{{.}}">{{.}}</option>
									{{end}}
								</select>
								{{svg "octicon-triangle-down" 14 "dropdown icon"}}

								<div class="default text"> </div>

								<div class="menu">
									{{range .LockReasons}}
										<div class="item" data-value="{{.}}">{{.}}</div>
									{{end}}
								</div>
							</div>
						</div>
					{{end}}

					<div class="text right actions">
						<button class="ui cancel button">{{ctx.Locale.Tr "settings.cancel"}}</button>
						<button class="ui red button">
							{{if .Issue.IsLocked}}
								{{ctx.Locale.Tr "repo.issues.unlock_confirm"}}
							{{else}}
								{{ctx.Locale.Tr "repo.issues.lock_confirm"}}
							{{end}}
						</button>
					</div>
				</form>
			</div>
		</div>
		<button class="tw-mt-1 fluid ui show-modal button" data-modal="#sidebar-delete-issue">
			{{svg "octicon-trash"}}
			{{ctx.Locale.Tr "repo.issues.delete"}}
		</button>
		<div class="ui g-modal-confirm modal" id="sidebar-delete-issue">
			<div class="header">
				{{if .Issue.IsPull}}
					{{ctx.Locale.Tr "repo.pulls.delete.title"}}
				{{else}}
					{{ctx.Locale.Tr "repo.issues.delete.title"}}
				{{end}}
			</div>
			<div class="content">
				<p>
					{{if .Issue.IsPull}}
						{{ctx.Locale.Tr "repo.pulls.delete.text"}}
					{{else}}
						{{ctx.Locale.Tr "repo.issues.delete.text"}}
					{{end}}
				</p>
			</div>
			<form action="{{.Issue.Link}}/delete" method="post">
				{{.CsrfTokenHtml}}
				{{template "base/modal_actions_confirm" .}}
			</form>
		</div>
	{{end}}

	{{if and .Issue.IsPull .IsIssuePoster (not .Issue.IsClosed) .Issue.PullRequest.HeadRepo}}
		{{if and (not (eq .Issue.PullRequest.HeadRepo.FullName .Issue.PullRequest.BaseRepo.FullName)) .CanWriteToHeadRepo}}
			<div class="divider"></div>
			<div class="inline field">
				<div class="ui checkbox loading-icon-2px" id="allow-edits-from-maintainers"
						data-url="{{.Issue.Link}}"
						data-tooltip-content="{{ctx.Locale.Tr "repo.pulls.allow_edits_from_maintainers_desc"}}"
						data-prompt-error="{{ctx.Locale.Tr "repo.pulls.allow_edits_from_maintainers_err"}}"
					>
					<label><strong>{{ctx.Locale.Tr "repo.pulls.allow_edits_from_maintainers"}}</strong></label>
					<input type="checkbox" {{if .Issue.PullRequest.AllowMaintainerEdit}}checked{{end}}>
				</div>
			</div>
		{{end}}
	{{end}}
</div>
